function [Y,Xf,Af] = myNeuralNetworkFunction(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 22-Mar-2017 11:16:27.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = Qx64 matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = Qx10 matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.keep = [2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64];
x1_step2.xoffset = [0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0];
x1_step2.gain = [0.25;0.125;0.125;0.125;0.125;0.125;0.125;0.4;0.133333333333333;0.125;0.125;0.125;0.125;0.125;0.133333333333333;0.4;0.125;0.125;0.125;0.125;0.125;0.125;0.25;2;0.125;0.125;0.125;0.125;0.125;0.125;1;2;0.133333333333333;0.125;0.125;0.125;0.125;0.142857142857143;0.285714285714286;0.125;0.125;0.125;0.125;0.125;0.125;0.333333333333333;0.2;0.125;0.125;0.125;0.125;0.125;0.125;0.166666666666667;2;0.2;0.125;0.125;0.125;0.125;0.125;0.125];
x1_step2.ymin = -1;

% Layer 1
b1 = [1.1608620066777138;0.89519105354986139;-0.59885288174305273;0.4183083951202537;0.26777338554332764;0.39508931317657786;-0.42883587144426977;-0.61439919195204551;-1.2053058485992807;-1.4368786174850017];
IW1_1 = [-0.34588278071252632 0.29418341586602126 0.15638359472536473 -0.15013152265475418 0.21119484337669228 0.047364222206942544 0.18384758834256099 -0.027955423058709995 -0.17374661875169786 0.71568933732413187 0.023704883118813073 -0.40670363137534393 -0.13850268835091567 -0.2615927491784687 -0.10243719322100298 0.48326844976692485 0.13143852779090762 1.3216916523553557 0.8276981656723722 -1.272502957836928 0.050613912773661646 -0.28276521630226864 0.18607464691469383 0.29050384999029633 -0.12159039691195236 0.37765710340082848 0.75763741622542902 -0.28879321051709561 1.1314627470371543 0.040522859668322642 0.21284531987552538 0.21170064593997492 -0.0814005735214611 0.42683283799509686 0.27465827598706993 -0.63021041914763254 -0.88560462065921286 0.17552764484414926 0.064508750832330208 -0.13940910350348887 0.01113067710998588 -0.42569663656421514 -0.2551300591230049 0.36108248672377824 0.20853804091718911 0.57016985671412568 0.57202556710850505 -0.012231845035717575 0.31632812822775402 -0.90225922341736875 -0.068632094730063375 -0.55556829236002891 -0.43996001889691244 -0.19664748829177389 0.28888727764782385 -0.3700859750986295 -0.57418729808890634 0.44804664797981292 -0.081212309285676423 -0.55771116198639503 0.12213630376692723 0.2267754380138686;0.18380269786788869 0.48311000534164489 -0.16077967163246815 0.87257636008965622 0.81852138518117734 0.074268765619228946 0.2001197830825896 0.083688186235046008 -0.03131381020173489 0.43856171727118831 1.1229023094678183 0.65512758243948366 -0.049452351998680366 -0.36953032692384447 0.051203983034352391 0.17947763225153168 -0.30430692364198814 -0.87595851351642873 -0.75332083732351496 -0.08079811673522895 -0.14533283350130577 -0.28858546549892289 0.2305101763194741 0.11899026660409884 -0.091207194969749175 0.17032331884487817 -0.18789560771672301 -0.26763841010186024 -0.62168987890168226 0.33011911173168579 0.11076881160008448 -0.067291735155522059 0.12247713449029693 0.045782904680498317 -0.0094818801908876649 -0.55849385587364264 -0.12712204316648365 0.8939137543359762 0.2428809594161272 0.1880920581743859 -1.5878664004518495 -1.2698750590508037 -0.4646844097044871 0.61673275821194229 0.60189072202714822 0.18796863586639276 -0.0078903837695168885 -0.12328742151801625 -0.26806942759471203 0.2032227204024675 -0.61432887207434161 -0.58221973617132994 -0.19144790399437109 -0.15064766475540389 0.34330376899784859 0.237590815972886 0.58058837392093277 0.18484756830318771 -0.84003926627079473 -0.27475039073741697 -0.72448182915829717 0.060681628468544822;-0.13735318269531757 -0.14403304443413156 -0.16079640048875826 0.19106808656709842 -0.35458029192113066 -0.3978590761575494 0.041598910416959303 -0.18409613610170325 -0.0021223822315971624 0.18049859961662879 0.23750847456857102 0.044055921061377873 0.1310099052593845 -0.28899821479510562 -0.10276095616469115 -0.0052763684648170165 -0.032389538228358591 -0.036872999250515619 -0.081894087171524396 -0.18056348604116607 -0.002797320148347382 -0.2425440448588384 -0.1915613153779343 -0.43793800888354123 -0.13237286411991719 0.13873648887839948 0.0056622527236878254 0.069577966571920835 0.21567818824886231 -0.4326566201550589 -0.087113914465156359 -0.16569192397717442 -0.04593676641825805 -0.18333725752051469 -0.23467177035340378 -0.16139136057775513 -0.14699970085019715 -0.094130713666839727 0.044721153099008266 -0.21420097134417959 -0.26442394307368827 -0.25798795887650178 0.34755646712010735 -0.10257471033673102 -0.44231452441272284 -0.4919707071414513 -0.036877789498912301 0.12450820821957985 -0.22203811514764143 0.13477320385700403 0.10602006116603223 0.31799759298664748 0.2454085288516612 -0.45432923456433338 -0.31258510765432113 -0.22712908979043694 -0.28255806291186286 0.044749245790183516 -0.13638993197999028 -0.24852831904667394 -0.27540473840019553 -0.37105592343269028;0.0094776900458942385 -0.11214763475916682 -0.35961944057948608 -0.14399960788102631 -0.11662918441136993 0.080624954877211774 0.15962720294644472 -0.049787804238281066 -0.45758851739107298 -0.38317283149369918 -0.13831704585062168 -0.21664233259327048 -0.71416284547990361 -0.34340160607324877 -0.27584835464274787 0.058289210897863659 -0.17363579967352324 0.38419099884751323 0.31869641714766905 -0.67740587239582362 -1.0798920730231503 -0.79028569144385341 -0.10691291553925129 0.16059116247997954 0.84357488679606052 1.172476625505448 -0.20672958295160437 -0.87917183692342227 -0.41706636894394278 0.28945511939882163 0.36026298096630038 -0.2114115349502225 0.99993177803383571 -0.15595859328920111 -0.54369510824213074 -0.72622981283708232 0.49676269543452656 1.0709686745975429 0.01152373581374154 0.26409734603803842 -0.18526226844050198 -0.12882495802978708 0.14695834545228917 0.099471977560747007 0.083401049285338077 0.10030103174640941 0.042423375268201509 -0.34203780291305136 0.040765065681544012 0.79589356658769672 0.79380888236374514 -0.1192676923505856 -0.39812640320420423 0.11362675262942801 -0.069204191430657133 -0.011211887889215112 0.23977236303440511 -0.4596463315692299 0.30250887097287665 0.32633932249747793 -0.30070228894813827 0.22191062127044001;-0.2901000411707112 0.39258295674417731 -0.1906951711319913 -0.24944584893593266 -1.3581791690976406 -0.44565327240629155 0.080821983613132656 -0.39063883394702675 -0.15602989225514041 -0.21945902096343886 -0.23129834243493325 -0.091599938485491306 -0.16069558781180165 0.28718713876922136 -0.095737121871945649 0.24876093414842676 0.040528130055581674 -0.39113334760497598 -0.2086019976295603 -0.030540772059782312 0.9827149938417663 0.54966245681164017 0.045871138702692854 -0.076497482998873476 0.19482129850673349 0.20429069058922808 0.6155972385207793 -0.62905778607540286 -0.020605410174783019 1.2703720543108412 0.090275692527244031 -0.064958277245091262 0.37027995604891856 0.77032246019511075 -0.72675744185116098 -0.22614363482201191 0.49003022746151093 0.89684143646471337 -0.27430794809998194 0.44775919993951196 -0.1155657317503707 -0.13431495534818555 0.20381841228904121 -0.19312810064800684 -0.24290809865521776 -0.26203998002755308 -0.04386004451422143 1.0342541452448206 -0.17650031203667751 0.10196556673521041 -0.35192986883834104 -0.25105559335197863 -0.37347208916463237 -0.36338890103916827 -0.27294041360363797 0.25643815076583615 -0.53361085285997367 -1.4755578467667378 -0.17001903808790933 -0.56212437898878254 -0.15930253641033523 -0.28449057971003333;-0.025619016495474552 0.47463834136885208 -0.39794724570625484 -0.18593199194840127 0.39413877750256959 0.69528094352533554 -0.12183278979147874 -0.30227568253748766 0.023631187005238578 -0.83951539028308975 0.2147555268040118 -0.13098766352026717 -0.43514798061869209 -0.21086342873159306 0.1642267156976519 -0.24686494361720501 -0.052685277436407198 0.20631147505962427 0.40151387300982472 -0.16156760271026721 -1.058882710900523 -0.92248731760650371 0.038336154098707664 0.18991417233088498 -0.33526493986632311 0.17663758220936496 0.16586493608689487 0.15684247376130908 0.77834188648696623 -0.088384253002968871 -0.26757378281471322 -0.15896761156213091 0.47670102060121256 -0.044699635284838918 0.66358320757471234 0.51634652670975545 0.63799515038770394 0.58625655364331131 0.024678420312786914 -0.067606863192036917 -0.0058438528391368035 0.79925746456407176 0.76575004319521356 0.2016997874256376 0.2414696474884056 -0.11074905340951215 -0.078807490678064557 -0.25005355849938515 -0.38901541941693452 -0.82214546563843294 -0.26959554672897934 -0.69787625634494166 0.096462198650465181 -0.041338737161628919 -0.12622625247228655 -0.24330906573929909 -0.089477757599631891 -0.9247928782702366 -0.053643827033791835 0.047118191279722235 -0.36083460118913657 0.034817133884185739;-0.22955282861654963 -0.22831068185201631 -0.47046751283234722 0.41038104622281646 -0.64747106468775184 -0.46290046036376864 0.060903130092370153 -0.15075242022437679 -0.8298456874373461 -0.13012620172295897 0.14668923843141465 -0.30111321629648585 0.19183904228240134 -0.20923293670692109 0.2993772720458121 0.017907516448131357 0.036677060929165436 0.27218604686097292 -0.37102528004633734 -0.42553592469686069 0.3765771513011113 0.20233112401142977 -0.11284178466498468 -0.46320134523586076 0.22909734055649167 -0.16301112533361056 0.47052268684461157 -0.089745339416693604 -0.042664221013027435 0.85883460165281855 0.11071785014192619 -0.30436609857489838 0.1231252570414227 -0.047226583469278972 0.12581194645055435 -0.087165834846249096 -0.074701094114949601 0.50356351071662186 -0.11215120502356374 0.24375857237499704 1.8022264890400572 0.91218634038555158 0.50877581714953168 0.055068219093411391 0.176119377037248 0.23093973954184752 -0.34071262349505588 -0.16438195993367702 0.066850650116987931 0.33948988677680969 -1.1877283158908962 -0.27120282580062427 0.22905811756503422 -0.18669039170482435 -0.22311998825527857 -0.35156959078414785 -0.69225874023838496 -0.31319514149709526 -0.72634739964947181 -0.58011692351686373 -0.44942387557941188 0.16362002496259165;-0.70422633953738423 0.45951983909612754 0.018223107468601795 -0.11129402410726341 0.20958518645252125 0.69297410893327493 0.44821768769755915 -0.034797897957824737 0.0010204902469386969 -0.062355965704627744 0.055883135752111117 0.32868345786706143 -0.19193143990733363 -0.047282901941820589 0.10219401243935629 -0.027192936533693261 -0.10440960994607483 0.071559387606582578 0.27536567799231687 0.4448063924365574 -0.96379379496453377 -0.35843474092202909 -0.14391184761361994 -0.18428206094141936 0.18023042123065497 -0.4935539974708032 -0.32988276479917866 0.0051363704749870301 0.79972184812880975 0.33218528435933575 -0.36394633627763079 0.084879520379906676 0.42364017186947328 -0.15280465358485715 -0.21000990090177707 0.16753972109137025 0.73855762218454357 -0.41293987346775457 -0.18881724344801368 0.16363197986398889 -0.12158534282228083 0.95086114748466399 -0.18715291556587293 -1.2369788762008422 -1.5689768095808152 -0.5108659940022976 -0.17818183914206992 0.37087997143547868 0.26550481393241904 -0.085856258279560449 0.39017486562046566 -0.655289082928457 0.10844590327784924 -0.23996040111653777 -0.40847810670454665 -0.043906330482783543 0.020125798336361786 -0.22181618254884389 -0.96219475117686992 0.49253101345631672 0.73226808822187028 0.38579938184860735;-0.032137240864718572 -0.1017556877878176 0.38727181653755921 -0.63372210168366772 -0.66454467957953278 -0.29406248311709038 -0.49755997433890653 0.12038361593633361 -0.14420862733005974 -0.28766806430629266 -0.454434147630361 -0.29643124814502925 -0.016578369250170352 0.50327092232852255 -0.043295904769671677 0.0035395046689942079 0.21079170082265239 0.67632378803107207 1.3901635299443096 1.0144477163905943 1.1978116386541278 0.43064448214621037 -0.11020830112562734 0.076223899155468025 0.21193843671867932 1.0231521868397568 0.19487013179475129 -0.12179197980378391 0.5342607964551318 -0.20112550024770823 -0.14755599503675557 0.13360368705383413 -0.70530185508022092 0.21714741401529383 0.11420988930744064 -0.67697724307951335 -0.090354852091556526 -0.46762909600255526 0.2901178775426092 -0.26958153427237708 -0.46488153329870818 -0.69766865800367139 0.14738010355191203 -0.18771059953624722 0.0041730165343233649 -0.14470751533494822 -0.026053613218260423 -0.10122489033230574 0.024788641249520408 0.0059775646540901808 0.19971045725576694 -0.81147146899806066 -0.36799028290241459 -0.014263140420520092 0.084247450929831713 0.27616254373888438 -0.4486257266264807 -0.051179987874973812 0.12100361560927513 0.54156644998827685 -0.395738582599716 -0.039871563296387746;-0.11731690771761129 0.33152967111120502 0.63112169440285082 0.38880895442333635 0.016642593579891118 0.31052239967916029 0.27423206705437397 -0.15678420021756134 0.72092853750821173 0.64173228622126777 0.37379166154155041 0.79053020268527707 -0.10580106312399788 0.31260881346448688 -0.01141632335297971 -0.28651291020100356 -0.30020988868502585 -0.73987386540432476 -0.54500679785986506 -0.091375103941366678 0.61284885443631054 0.81461403379250585 0.32653750716582852 0.080443884017056211 -0.543284794881844 -0.33385164312116011 0.34404241849260936 0.61542747545115861 0.47334315902113611 0.28031676980164788 -0.016816914333076267 0.16748505181186329 -0.17199525863885209 -0.18542378151192945 0.76921237815030374 0.54137258922847775 0.98401533346036263 -0.24314567620921756 0.29246492767680582 0.15215862631511787 -1.3557687164233554 -0.92866499603233166 -0.098546080233672728 0.19388966792393666 0.18324072160652571 0.18211209912593571 0.28984094846903041 -0.23511944565942028 -0.38474813273228958 -0.22447302070336489 -1.2705058059965813 -1.089885572291537 -0.12950258246808116 -0.18907156919334211 0.030317577689428235 0.27010784132227705 -0.33009817763039651 0.24096114756103482 0.27744112008193422 -0.48618565087220361 -0.35898690670147032 -0.27489889258730688];

% Layer 2
b2 = [0.80757196159979061;1.0770132005749165;-0.95621826197725546;-0.12266004038193687;0.43082670214239827;0.472416633119569;-1.2729837512596049;-0.46568852175779712;0.36179046954082311;1.1564815929943431];
LW2_1 = [1.0453267913314666 0.034343028439887707 -0.49947158940124842 2.2641832484426874 2.6993405798946615 -2.0687679413986726 1.44331783012562 -1.6389325722580959 0.60246392995469866 -1.5535978954878686;-1.4108812869346352 -2.1487672916579603 -0.29277312909699837 -0.19736025294311998 -0.089035688103776267 3.1361988917362766 -1.6060895516555607 1.6015349431361185 2.266887506376277 -1.2692447450188491;-1.710033503472951 -1.9862668148988158 0.68340717267707707 0.21645798308698175 -0.98457638189303165 -3.2947510516154757 -1.4409565639085766 2.7157773635297935 -1.5653756443579807 -1.0535452398702794;-2.0568701759356216 1.3053739687320942 0.064131856396421688 0.78250938558079985 -1.5078478404838256 -0.38850834624966252 -2.1216747421719955 -1.7938369874148563 -0.37661287015701433 1.7969160606786518;0.73733516285442291 -1.7777642572260604 0.46322001103858307 1.9259069520682026 4.4122808403738354 2.776914859368568 1.1332353507858535 0.86044822411766275 0.20185479105704629 0.25009231593518894;2.7136017238169767 2.9059101804913858 -0.016245619565034453 1.2337043807395163 -2.2561076833620546 0.90891917046049453 -1.9981424764741784 1.3642722388003041 -1.3884416836841469 0.10883859843908618;-0.67862047332613262 -1.6891092039844366 -0.18248880915302082 2.5392020270920437 -2.2603358226882881 1.0292159381522614 2.0443647097752593 -1.2600411777631819 -0.84677676426898096 -0.87511055990141196;-2.3118816345944504 1.767130004836307 0.059592544165801606 -0.77096178328547627 0.98333494065250582 1.5760235312735476 1.7260711834874936 2.1799403599993368 -1.0658072343231473 2.4355645614873933;1.213386028494176 -2.8070024407607823 0.25407634829095926 -2.6353846747761853 -0.9028974255264246 -0.943318566317213 1.287527644161568 -1.1526272867338656 0.019097093176529675 -1.0096278956716778;1.8316680945754138 0.67731125586430652 -0.087874535030116732 -1.6387361268774749 0.11861715761568561 -0.73483519454964086 -1.5152976337226345 -0.17833763506470926 3.1174790613047239 3.1653254639819286];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},1); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    X{1,ts} = X{1,ts}';
    temp = removeconstantrows_apply(X{1,ts},x1_step1);
    Xp1 = mapminmax_apply(temp,x1_step2);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
    Y{1,ts} = Y{1,ts}';
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Remove Constants Input Processing Function
function y = removeconstantrows_apply(x,settings)
y = x(settings.keep,:);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n,~)
if isa(n,'gpuArray')
    a = iSoftmaxApplyGPU(n);
else
    a = iSoftmaxApplyCPU(n);
end
end
function a = iSoftmaxApplyCPU(n)
nmax = max(n,[],1);
n = bsxfun(@minus,n,nmax);
numerator = exp(n);
denominator = sum(numerator,1);
denominator(denominator == 0) = 1;
a = bsxfun(@rdivide,numerator,denominator);
end
function a = iSoftmaxApplyGPU(n)
nmax = max(n,[],1);
numerator = arrayfun(@iSoftmaxApplyGPUHelper1,n,nmax);
denominator = sum(numerator,1);
a = arrayfun(@iSoftmaxApplyGPUHelper2,numerator,denominator);
end
function numerator = iSoftmaxApplyGPUHelper1(n,nmax)
numerator = exp(n - nmax);
end
function a = iSoftmaxApplyGPUHelper2(numerator,denominator)
if (denominator == 0)
    a = numerator;
else
    a = numerator ./ denominator;
end
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
